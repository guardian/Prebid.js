(self.pbjsChunk=self.pbjsChunk||[]).push([[469],{9557:(e,t,n)=>{var o=n(8676),r=n(7260),s=n(9581),i=n(5662),a=n(2649),c=n(2305),u=n(6650),l=n(9328),d=n(1218);const f=new Map;function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f;const n={};function o(e){const t=JSON.stringify([e.source?.toLowerCase(),...Object.keys(e).filter((e=>!["uids","source"].includes(e))).sort().map((t=>e[t]))]);n.hasOwnProperty(t)?n[t].uids.push(...e.uids):n[t]=e}return Object.entries(e).forEach((e=>{let[n,r]=e;r=Array.isArray(r)?r:[r];const s=t.get(n);let i;if("pubProvidedId"===n)i=(0,d.Go)(r);else if("function"==typeof s)try{i=s(r),Array.isArray(i)||(i=[i]),i.forEach((e=>e.uids=e.uids.filter((e=>{let{id:t}=e;return(0,d.O8)(t)})))),i=i.filter((e=>{let{uids:t}=e;return t?.length>0}))}catch(e){(0,d.vV)(`Could not generate EID for "${n}"`,e)}else i=r.map((e=>function(e,t,n){if(n&&e){let t={};t.source=(0,d.fp)(n.getSource)?n.getSource(e):n.source;const o=(0,d.fp)(n.getValue)?n.getValue(e):e;if((0,d.O8)(o)){const r={id:o,atype:n.atype};if((0,d.fp)(n.getUidExt)){const t=n.getUidExt(e);t&&(r.ext=t)}if(t.uids=[r],(0,d.fp)(n.getEidExt)){const o=n.getEidExt(e);o&&(t.ext=o)}return t}}return null}(e,0,s)));Array.isArray(i)&&i.filter((e=>null!=e)).forEach(o)})),Object.values(n)}function m(e){const t=new Map,n={};return Object.entries(e).forEach((e=>{let[o,r]=e;const s=r.find((e=>null!=e.idObj?.[o]));if(s){n[o]=s.idObj[o];let e=s.submodule.eids?.[o];"function"==typeof e&&(i=e,e=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i(...t,s.config)}),t.set(o,e)}var i})),g(n,t)}var b=n(2707),h=n(3172),p=n(1433),y=n(8776),I=n(8001),v=n(3044),w=n(9024),E=n(6402),S=n(5584),D=n(4202),k=n(1695),O=n(7790);const j="User ID",$=b.X0,A=b.qk,T="_pbjs_id_optout",C=(0,b.CK)("userId"),x={isAllowed:E.io};let N,U,_,L,P,H=[],J=[],q={},M=[];const V=(()=>{let e;return()=>(null==e&&(e=(0,I.K7)()),e)})();function F(e){return V().fork().renameWith((t=>[`userId.mod.${t}`,`userId.mods.${e}.${t}`]))}function W(e,t){t=t||e.storageMgr;const n="function"==typeof e.submodule.domainOverride?e.submodule.domainOverride():null,o=e.config.storage.name;return function(e,r,s){t.setCookie(o+(e||""),r,s,"Lax",n)}}function G(e,t){const n=e.config.storage;try{const o=new Date(Date.now()+864e5*n.expires).toUTCString(),r=(0,d.Qd)(t)?JSON.stringify(t):t;e.enabledStorageTypes.forEach((t=>{switch(t){case $:!function(e,t,n){const o=e.config.storage,r=W(e);r(null,t,n),r("_cst",me(),n),"number"==typeof o.refreshInSeconds&&r("_last",(new Date).toUTCString(),n)}(e,r,o);break;case A:!function(e,t,n){const o=e.config.storage,r=e.storageMgr;r.setDataInLocalStorage(`${o.name}_exp`,n),r.setDataInLocalStorage(`${o.name}_cst`,me()),r.setDataInLocalStorage(o.name,encodeURIComponent(t)),"number"==typeof o.refreshInSeconds&&r.setDataInLocalStorage(`${o.name}_last`,(new Date).toUTCString())}(e,r,o)}}))}catch(e){(0,d.vV)(e)}}function R(e){we(e),e.enabledStorageTypes.forEach((t=>{switch(t){case $:!function(e){const t=W(e,C),n=new Date(Date.now()-864e5).toUTCString();["","_last","_cst"].forEach((e=>{try{t(e,"",n)}catch(e){(0,d.vV)(e)}}))}(e);break;case A:!function(e){["","_last","_exp","_cst"].forEach((t=>{try{C.removeDataFromLocalStorage(e.config.storage.name+t)}catch(e){(0,d.vV)(e)}}))}(e)}}))}function B(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;const n=e.config.storage,o=t?`${n.name}_${t}`:n.name;let r;try{e.enabledStorageTypes.find((t=>{switch(t){case $:r=function(e,t){return e.storageMgr.getCookie(t)}(e,o);break;case A:r=function(e,t){const n=e.storageMgr,o=e.config.storage,r=n.getDataFromLocalStorage(`${o.name}_exp`);return""===r?n.getDataFromLocalStorage(t):r&&new Date(r).getTime()-Date.now()>0?decodeURIComponent(n.getDataFromLocalStorage(t)):void 0}(e,o)}return!!r})),"string"==typeof r&&"{"===r.trim().charAt(0)&&(r=JSON.parse(r))}catch(e){(0,d.vV)(e)}return r}function Q(e,t,n){t=V().fork().startTiming("userId.callbacks.total").stopBefore(t);const o=(0,d.U6)((()=>{clearTimeout(undefined),t()}),e.length);e.forEach((function(e){const t=F(e.submodule.name).startTiming("callback").stopBefore(o);try{e.callback((function(o){o?(e.config.storage&&G(e,o),e.idObj=e.submodule.decode(o,e.config),n.refresh(),he(n)):(0,d.fH)(`${j}: ${e.submodule.name} - request id responded with an empty value`),t()}),B.bind(null,e))}catch(n){(0,d.vV)(`Error in userID module '${e.submodule.name}':`,n),t()}e.callback=void 0}))}function z(e){return Object.fromEntries(Object.entries(e).map((e=>{let[t,n]=e;return[t,n.find((e=>null!=e.idObj?.[t]))?.idObj?.[t]]})).filter((e=>{let[t,n]=e;return null!=n})))}function K(e,t,n){const o={};return e.forEach((e=>{const r=n(e),s=function(e){if(e.primaryIds)return e.primaryIds;const t=Object.keys(e.eids??{});if(t.length>1)throw new Error(`ID submodule ${e.name} can provide multiple IDs, but does not specify 'primaryIds'`);return t}(r);t(e).forEach((t=>{const n=o[t]=o[t]??[],i=q[t]?.indexOf(r.name)??(s.includes(t)?0:-1),a=n.findIndex((e=>{let[t]=e;return t<i}));n.splice(-1===a?n.length:a,0,[i,e])}))})),Object.fromEntries(Object.entries(o).map((e=>{let[t,n]=e;return[t,n.map((e=>{let[t,n]=e;return n}))]})))}function Y(){const e={submodules:[],global:{},bidder:{},combined:{},refresh(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const n=new Set(t.map((e=>e.submodule)));e.submodules=e.submodules.filter((e=>!n.has(e.submodule))).concat(t),function(){const t=K(e.submodules,(e=>Object.keys(e.idObj??{})),(e=>e.submodule)),n={},o={};Object.entries(t).forEach((e=>{let[t,r]=e,s=!0;const i=new Set;r.map((e=>e.config.bidders)).forEach((e=>{Array.isArray(e)&&e.length>0?e.forEach((e=>i.add(e))):s=!1})),i.size>0&&!s?(0,d.JE)(`userID modules ${r.map((e=>e.submodule.name)).join(", ")} provide the same ID ('${t}'), but are configured for different bidders. ID will be skipped.`):0===i.size?n[t]=r:i.forEach((e=>{o[e]=o[e]??{},o[e][t]=r}))}));const r=Object.values(o).concat([n]).reduce(((e,t)=>Object.assign(e,t)),{});Object.assign(e,{global:n,bidder:o,combined:r})}()}};return e}function X(e){let{adUnits:t,ortb2Fragments:n}=e;if(n=n??{global:{},bidder:{}},function(e){const{global:t,bidder:n}=e,{global:o,bidder:r}=N,s=m(o);s.length>0&&(0,h.J)(t,"user.ext.eids",(t.user?.ext?.eids??[]).concat(s)),Object.entries(r).forEach((e=>{let[t,o]=e;const r=m(o);r.length>0&&(0,h.J)(n,`${t}.user.ext.eids`,(n[t]?.user?.ext?.eids??[]).concat(r))}))}(n),[t].some((e=>!Array.isArray(e)||!e.length)))return;const o=z(N.global),r=n.global.user?.ext?.eids||[];t.forEach((e=>{e.bids&&(0,d.cy)(e.bids)&&e.bids.forEach((e=>{const t=Object.assign({},o,z(N.bidder[e.bidder]??{})),s=r.concat(n.bidder[e.bidder]?.user?.ext?.eids||[]);Object.keys(t).length>0&&(e.userId=t),s.length>0&&(e.userIdAsEids=s)}))}))}const Z={};let ee;function te(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie()||[];const t=L&&e.find((e=>e.source===L));if(t&&"string"==typeof t?.uids?.[0]?.id){const e=t.uids[0].id.replace(/[\W_]/g,"");if(e.length>=32&&e.length<=150)return e;(0,d.JE)(`User ID - Googletag Publisher Provided ID for ${L} is not between 32 and 150 characters - ${e}`)}}const ne=(0,I.Ak)("userId",(function(e,t){let{delay:n=y.k.timeout,getIds:o=ge}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};y.k.race([o().catch((()=>null)),n(_)]).then((()=>{X(t),V().join((0,I.BO)(t.metrics),{propagate:!1,includeGroups:!0}),e.call(this,t)}))})),oe=(0,I.Ak)("userId",(function(e,t){X(t),e.call(this,t)}));function re(){return!!O.gH.getHooks({hook:ne}).length}function se(){return z(N.combined)}function ie(){return m(N.combined)}function ae(e){return ie().filter((t=>t.source===e))[0]}function ce(e,t,n){return de().then((()=>{let o={};if((0,d.fp)(n)){(0,d.fH)(`${j} - Getting encrypted signal from custom function : ${n.name} & source : ${e} `);const t=n(e);o[e]=t?ue(t):null}else{const n=ae(e);(0,d.fH)(`${j} - Getting encrypted signal for eids :${JSON.stringify(n)}`),(0,d.Im)(n)||(o[n.source]=!0===t?ue(n):n.uids[0].id)}return(0,d.fH)(`${j} - Fetching encrypted eids: ${o[e]}`),o[e]}))}function ue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n="";if(1===t)n="object"==typeof e?window.btoa(JSON.stringify(e)):window.btoa(e);return`${t}||${n}`}function le(){if(!(0,d.II)())return;window.googletag.secureSignalProviders=window.googletag.secureSignalProviders||[];const e=s.$W.getConfig("userSync.encryptedSignalSources");if(e){const t=e.registerDelay||0;setTimeout((()=>{e.sources&&e.sources.forEach((e=>{let{source:t,encrypt:n,customFunc:o}=e;t.forEach((e=>{window.googletag.secureSignalProviders.push({id:e,collectorFunction:()=>ce(e,n,o)})}))}))}),t)}else(0,d.JE)(`${j} - ESP : encryptedSignalSources config not defined under userSync Object`)}function de(e){return ee(e).then((()=>se()),(e=>e===Z?Promise.resolve().then(ge):((0,d.vV)("Error initializing userId",e),y.k.reject(e))))}function fe(){let{submoduleNames:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return de({refresh:!0,submoduleNames:e}).then((e=>(t&&(0,d.fp)(t)&&t(),e)))}function ge(){return de()}function me(){let e=Number(a.SL.hash);const t=[];for(;e>0;)t.push(String.fromCharCode(255&e)),e>>>=8;return btoa(t.join())}function be(e,t){const n=a.mW.getConsentData();if(e.config.storage){let o,r=B(e),s=!1;if("number"==typeof e.config.storage.refreshInSeconds){const t=new Date(B(e,"last"));s=t&&Date.now()-t.getTime()>1e3*e.config.storage.refreshInSeconds}if(!r||s||t||function(e){const t=B(e,"cst");return!t||t!==me()}(e)){const t=Object.assign({enabledStorageTypes:e.enabledStorageTypes},e.config);o=e.submodule.getId(t,n,r)}else"function"==typeof e.submodule.extendId&&(o=e.submodule.extendId(e.config,n,r));(0,d.Qd)(o)&&(o.id&&(G(e,o.id),r=o.id),"function"==typeof o.callback&&(e.callback=o.callback)),r&&(e.idObj=e.submodule.decode(r,e.config))}else if(e.config.value)e.idObj=e.config.value;else{const t=e.submodule.getId(e.config,n,void 0);(0,d.Qd)(t)&&("function"==typeof t.callback&&(e.callback=t.callback),t.id&&(e.idObj=e.submodule.decode(t.id,e.config)))}}function he(e){const t=m(e.combined);if(t.length&&L){const e=te(t);e&&((0,d.II)()?window.googletag.pubads().setPublisherProvidedId(e):(window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],window.googletag.cmd.push((function(){window.googletag.pubads().setPublisherProvidedId(e)}))))}}function pe(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return V().fork().measureTime("userId.init.modules",(function(){if(!t.length)return[];if(t.forEach((e=>we(e))),!(t=t.filter((e=>(!e.config.storage||!!e.enabledStorageTypes.length)&&x.isAllowed(S.yl,(0,D.s)(w.fW,e.config.name))))).length)return(0,d.JE)(`${j} - no ID module configured`),[];const o=t.reduce(((e,t)=>F(t.submodule.name).measureTime("init",(()=>{try{be(t,n),e.push(t)}catch(e){(0,d.vV)(`Error in userID module '${t.submodule.name}':`,e)}return e}))),[]);return e.refresh(o),he(e),o}))}function ye(e){return e?.storage?.type?.trim().split(/\s*&\s*/)||[]}function Ie(e){function t(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];(0,d.JE)(`Invalid userSync.userId config: ${e}`,...n)}return Array.isArray(e)?e.filter((e=>{if(!e?.name)return t('must specify "name"',e);if(e.storage){if(!e.storage.name||!e.storage.type)return t('must specify "storage.name" and "storage.type"',e);if(!function(e){return ye(e).every((e=>ve.has(e)))}(e))return t('invalid "storage.type"',e);["expires","refreshInSeconds"].forEach((n=>{let o=e.storage[n];null!=o&&"number"!=typeof o&&(o=Number(o),isNaN(o)?(t(`storage.${n} must be a number and will be ignored`,e),delete e.storage[n]):e.storage[n]=o)}))}return!0})):(null!=e&&t("must be an array",e),[])}const ve=new Set([A,$]);function we(e){if(e.enabledStorageTypes)return;const t=ye(e.config);e.enabledStorageTypes=t.filter((t=>{switch(t){case A:return function(e){return!(!e.storageMgr.localStorageIsEnabled()||C.getDataFromLocalStorage(T)&&((0,d.fH)(`${j} - opt-out localStorage found, storage disabled`),1))}(e);case $:return function(e){return!(!e.storageMgr.cookiesAreEnabled()||C.getCookie(T)&&((0,d.fH)(`${j} - opt-out cookie found, storage disabled`),1))}(e)}return!1}))}function Ee(e){f.clear(),Object.entries(K(e,(e=>Object.keys(e.eids||{})),(e=>e))).forEach((e=>{let[t,n]=e;return f.set(t,n[0].eids[t])}))}function Se(){Ee(M);const e=Ie(J);if(!e.length)return;const t=M.filter((e=>!(0,r.I6)(H,(t=>t.name===e.name))));H.splice(0,H.length),t.map((t=>{const n=(0,r.I6)(e,(e=>e.name&&(e.name.toLowerCase()===t.name.toLowerCase()||t.aliasName&&e.name.toLowerCase()===t.aliasName.toLowerCase())));return n&&t.name!==n.name&&(n.name=t.name),n?{submodule:t,config:n,callback:void 0,idObj:void 0,storageMgr:(0,b.vM)({moduleType:w.fW,moduleName:n.name})}:null})).filter((e=>null!==e)).forEach((e=>H.push(e))),H.length&&(re()||(O.gH.getHooks({hook:oe}).remove(),O.gH.before(ne,100),c.Ay.callDataDeletionRequest.before(De),p.Q.after((e=>e(te())))),(0,d.fH)(`${j} - usersync config updated for ${H.length} submodules: `,H.map((e=>e.submodule.name))))}function De(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];(0,d.fH)("UserID: received data deletion request; deleting all stored IDs..."),H.forEach((e=>{if("function"==typeof e.submodule.onDataDeletionRequest)try{e.submodule.onDataDeletionRequest(e.config,e.idObj,...n)}catch(t){(0,d.vV)(`Error calling onDataDeletionRequest for ID submodule ${e.submodule.name}`,t)}R(e)})),e.apply(this,n)}function ke(e){return function(){return Promise.resolve(e.apply(this,arguments))}}!function(e){let{delay:t=y.k.timeout}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};L=void 0,H=[],J=[],N=Y(),ee=function(){let{delay:e=y.k.timeout}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=(0,y.v)(),n=(0,y.v)();let o,r,s=!1;function c(e){return r=V().fork(),null!=o&&o.reject(Z),o=(0,y.v)(),y.k.race([e,o.promise]).finally(r.startTiming("userId.total"))}let f=N,g=H;function m(e){return function(){if(f===N&&g===H)return e(...arguments)}}function b(){return a.SL.promise.finally(r.startTiming("userId.init.consent"))}let h=c(y.k.all([l.Gc,t.promise]).then(b).then(m((()=>{pe(f,g)}))).then((()=>n.promise.finally(r.startTiming("userId.callbacks.pending")))).then(m((()=>{const e=f.submodules.filter((e=>(0,d.fp)(e.callback)));if(e.length)return new y.k((t=>Q(e,t,f)))}))));return function(){let{refresh:o=!1,submoduleNames:r=null,ready:a=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a&&!s&&(s=!0,t.resolve(),_>0?n.resolve():i.on(u.qY.AUCTION_END,(function t(){i.AU(u.qY.AUCTION_END,t),e(U).then(n.resolve)}))),o&&s&&(h=c(h.catch((()=>null)).then(b).then(m((()=>{const e=pe(f,g.filter((e=>null==r||r.includes(e.submodule.name))),!0).filter((e=>null!=e.callback));if(e.length)return new y.k((t=>Q(e,t,f)))}))))),h}}({delay:t}),null!=P&&P(),M=[],P=e.getConfig("userSync",(e=>{const t=e.userSync;t&&(L=t.ppid,t.userIds&&(J=t.userIds,U=(0,d.Et)(t.syncDelay)?t.syncDelay:k.qh.syncDelay,_=(0,d.Et)(t.auctionDelay)?t.auctionDelay:k.qh.auctionDelay,Se(),function(e,t){if(e){const n={},o=new Map(t.map((e=>e.aliasName?[e.aliasName,e.name]:[])));Object.keys(e).forEach((t=>{const r=(0,d.cy)(e[t])?[...e[t]].reverse():[];n[t]=r.map((e=>o.has(e)?o.get(e):e))})),q=n}else q={};N.refresh(),Ee(t)}(t.idPriority,M),ee({ready:!0})))})),(0,o.m)().getUserIds=se,(0,o.m)().getUserIdsAsEids=ie,(0,o.m)().getEncryptedEidsForSource=ke(ce),(0,o.m)().registerSignalSources=le,(0,o.m)().refreshUserIds=ke(fe),(0,o.m)().getUserIdsAsync=ke(ge),(0,o.m)().getUserIdsAsEidBySource=ae,re()||O.gH.before(oe,100)}(s.$W),(0,l.xG)("userId",(function(e){e.findRootDomain=v.S,(0,r.I6)(M,(t=>t.name===e.name))||(M.push(e),a.o2.register(w.fW,e.name,e.gvlid),Se(),ee({refresh:!0,submoduleNames:[e.name]}))}),{postInstallAllowed:!0}),(0,o.E)("userId"),(0,o.E)("userId")}},e=>{e.O(0,[802,85],(()=>{return t=9557,e(e.s=t);var t}));e.O()}]);