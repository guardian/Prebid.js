(self.pbjsChunk=self.pbjsChunk||[]).push([[328],{7616:(e,t,n)=>{n.d(t,{Gk:()=>W});var i=n(8676),s=n(8),r=n(1218),d=n(6650),o=n(2305),a=n(9581),c=n(6028),u=n(5662),p=n(7260);const b={appnexuspsp:{adapter:"prebidServer",enabled:!0,endpoint:{p1Consent:"https://ib.adnxs.com/openrtb2/prebid",noP1Consent:"https://ib.adnxs-simple.com/openrtb2/prebid"},syncEndpoint:{p1Consent:"https://prebid.adnxs.com/pbs/v1/cookie_sync",noP1Consent:"https://prebid.adnxs-simple.com/pbs/v1/cookie_sync"},maxTimeout:1e3},rubicon:{adapter:"prebidServer",enabled:!0,endpoint:{p1Consent:"https://prebid-server.rubiconproject.com/openrtb2/auction",noP1Consent:"https://prebid-server.rubiconproject.com/openrtb2/auction"},syncEndpoint:{p1Consent:"https://prebid-server.rubiconproject.com/cookie_sync",noP1Consent:"https://prebid-server.rubiconproject.com/cookie_sync"},maxTimeout:500},openwrap:{adapter:"prebidServer",enabled:!0,endpoint:{p1Consent:"https://ow.pubmatic.com/openrtb2/auction?source=pbjs",noP1Consent:"https://ow.pubmatic.com/openrtb2/auction?source=pbjs"},maxTimeout:500}};var l=n(8937),f=n(9328),g=n(1672),m=n(3999),h=n(3172),C=n(1544),y=n(5050),v=n(2884),B=n(3948),R=n(7173),O=n(8669),q=n(4202),E=n(9024),I=n(6402),x=n(5584),S=n(4258),j=n(500),$=n(433);function T(e){let{global:t,bidder:n}=e;return Object.fromEntries(Object.entries(n).map((e=>{let[n,i]=e;return[n,A(i,(0,r.D9)({},t,i))]})))}function A(e,t){return Object.fromEntries(Object.entries(e).map((e=>{let[n,i]=e;const s=t[n];return Array.isArray(i)?!(0,r.bD)(i,s)&&Array.isArray(s)&&(i=s):null!=i&&"object"==typeof i&&(i=A(i,s)),[n,i]})))}function w(e,t){let{global:n,bidder:i}=e;const s=function(e){let{eids:t,conflicts:n=new Set}=e;const i=[],s=[],r={};return t.forEach((e=>{(!1===e.bidders?i:s).push(e)})),s.forEach((e=>{let{eid:t,bidders:s}=e;n.has(t.source)?s.forEach((e=>{(r[e]=r[e]||[]).push(t)})):i.push({eid:t,bidders:s})})),{global:i.map((e=>{let{eid:t}=e;return t})),permissions:i.filter((e=>{let{bidders:t}=e;return!1!==t})).map((e=>{let{eid:t,bidders:n}=e;return{source:t.source,bidders:n}})),bidder:r}}(function(e){let{global:t,bidder:n}=e;const i=[],s={},d=new Set;function o(e){let t=i.find((t=>(0,r.bD)(t.eid,e)));return null==t&&(t={eid:e,bidders:new Set},i.push(t)),null==s[e.source]?s[e.source]=t.eid:t.eid===e&&d.add(e.source),t}return O.Vx.forEach((e=>{((0,$.A)(t,e)||[]).forEach((e=>{o(e).bidders=!1}))})),Object.entries(n).forEach((e=>{let[t,n]=e;O.Vx.forEach((e=>{((0,$.A)(n,e)||[]).forEach((e=>{const n=o(e);!1!==n.bidders&&n.bidders.add(t)}))}))})),{eids:i.map((e=>{let{eid:t,bidders:n}=e;return{eid:t,bidders:n&&Array.from(n)}})),conflicts:d}}({global:n,bidder:i}));function d(e){delete e?.user?.eids,delete e?.user?.ext?.eids}return n=(0,r.Go)(n),i=(0,r.Go)(i),d(n),Object.values(i).forEach(d),s.global.length&&(0,h.J)(n,"user.ext.eids",s.global),t?.length&&s.permissions.forEach((e=>e.bidders=e.bidders.filter((e=>t.includes(e))))),s.permissions.length&&(0,h.J)(n,"ext.prebid.data.eidpermissions",s.permissions),Object.entries(s.bidder).forEach((e=>{let[t,n]=e;n.length&&(0,h.J)(i[t],"user.ext.eids",n)})),{global:n,bidder:i}}function P(e,t){return null==e||0===Object.keys(e.bidder||{}).length?e:(e=w(e,t),{...e,bidder:T(e)})}const D=new Set(["bidderCode","bidderRequestId","uniquePbsTid","bids","timeout"]),k=(0,m.A)({processors:y.m,context:{netRevenue:!0},imp(e,t,n){Object.assign(n,t.pbsData);const i=e(t,n);if((t.bids||[]).forEach((e=>{e.ortb2Imp&&Object.keys(e.ortb2Imp).length>0&&(0,h.J)(i,`ext.prebid.imp.${e.bidder}`,e.ortb2Imp)})),Object.values(B.s).some((e=>i[e])))return i.secure=t.ortb2Imp?.secure??1,i},request(e,t,n,i){if(t.length){let{s2sBidRequest:s}=i;const r=e(t,n,i);return r.tmax=s.s2sConfig.timeout??Math.min(.75*s.requestBidsTimeout,s.s2sConfig.maxTimeout??W.maxTimeout),r.ext.tmaxmax=r.ext.tmaxmax||s.requestBidsTimeout,[r.app,r.dooh,r.site].forEach((e=>{e&&!e.publisher?.id&&(0,h.J)(e,"publisher.id",s.s2sConfig.accountId)})),i.transmitTids||(0,h.J)(r,"ext.prebid.createtids",!1),r}(0,r.vV)("Request to Prebid Server rejected due to invalid media type(s) in adUnit.")},bidResponse(e,t,n){let i=n.actualBidRequests.get(n.seatbid.seat);null==i&&(i=n.actualBidRequests.get(null)),i&&Object.assign(n,{bidRequest:i,bidderRequest:n.actualBidderRequests.find((e=>e.bidderCode===i.bidder))});const s=e(t,n);return s.requestBidder=i?.bidder,s.native?.ortb&&(s.adm=s.native.ortb),s.requestTimestamp=n.requestTimestamp,{bid:Object.assign((0,C.O)(d.XQ.GOOD,{src:d.RW.SRC,bidId:i?i.bidId||i.bid_Id:null,transactionId:n.adUnit.transactionId,adUnitId:n.adUnit.adUnitId,auctionId:n.bidderRequest.auctionId}),s,{deferRendering:!!n.adUnit.deferBilling,deferBilling:!!n.adUnit.deferBilling}),adUnit:n.adUnit.code}},overrides:{[R.Tb]:{id(e,t,n,i){t.id=i.impId},params(e,t,n,i){const s=i.s2sBidRequest.s2sConfig.adapterOptions;for(const e of i.actualBidRequests.values())(0,v.W)(t,e,i,i),s&&s[e.bidder]&&Object.assign(t.ext.prebid.bidder[e.bidder],s[e.bidder])},bidfloor(e,t,n,i){const s=(0,j.Bp)((0,S.x4)((e=>[e.bidfloor,e.bidfloorcur])));let r;for(const t of i.actualBidRequests.values()){const n={};if(e(n,t,i),null==n.bidfloorcur||null==n.bidfloor){r=null;break}r=null==r?n:s(r,n)}null!=r&&Object.assign(t,r)}},[R.S3]:{fpd(e,t,n,i){i.transmitTids&&(0,h.J)(t,"source.tid",n.auctionId),(0,r.D9)(t,i.s2sBidRequest.ortb2Fragments?.global),i.s2sBidRequest.s2sConfig.extPrebid&&"object"==typeof i.s2sBidRequest.s2sConfig.extPrebid&&(0,h.J)(t,"ext.prebid",(0,r.D9)(t.ext?.prebid||{},i.s2sBidRequest.s2sConfig.extPrebid)),i.getRedactor().ortb2(t);const s=Object.entries(i.s2sBidRequest.ortb2Fragments?.bidder||{}).filter((e=>{let[t]=e;const n=i.s2sBidRequest.s2sConfig.bidders;return i.s2sBidRequest.s2sConfig.allowUnknownBidderCodes||n&&n.includes(t)})).map((e=>{let[t,n]=e;return{bidders:[t],config:{ortb2:i.getRedactor(t).ortb2(n)}}}));s.length&&(0,h.J)(t,"ext.prebid.bidderconfig",s)},extPrebidAliases(e,t,n,i){i.actualBidderRequests.forEach((n=>e(t,n,i)))},sourceExtSchain(e,t,n,i){let s=t?.ext?.prebid?.schains||[];const r=new Set(s.flatMap((e=>e.bidders)));s=Object.values(s.concat(i.actualBidderRequests.filter((e=>!r.has(e.bidderCode))).map((e=>({bidders:[e.bidderCode],schain:e?.bids?.[0]?.schain})))).filter((e=>{let{bidders:t,schain:n}=e;return t?.length>0&&n})).reduce(((e,t)=>{let{bidders:n,schain:i}=t;const s=JSON.stringify(i);return e.hasOwnProperty(s)||(e[s]={bidders:new Set,schain:i}),n.forEach((t=>e[s].bidders.add(t))),e}),{})).map((e=>{let{bidders:t,schain:n}=e;return{bidders:Array.from(t),schain:n}})),s.length&&(0,h.J)(t,"ext.prebid.schains",s)}},[R.Cf]:{serverSideStats(e,t,n,i){i.actualBidderRequests.forEach((s=>e(t,n,{...i,bidderRequest:s,bidRequests:s.bids})))},paapiConfigs(e,t,n,i){const s=Object.values(i.impContext).flatMap((e=>(e.paapiConfigs||[]).map((t=>{const n=e.actualBidderRequests.find((e=>e.bidderCode===t.bidder)),i=e.actualBidRequests.get(t.bidder);return{adUnitCode:e.adUnit.code,ortb2:n?.ortb2,ortb2Imp:i?.ortb2Imp,bidder:t.bidder,config:t.config}}))));s.length>0&&(t.paapi=s)}}}});var U=n(8001);const J=a.$W.getConfig,_=d.RW.SRC;let N,V=0;const W={bidders:Object.freeze([]),syncTimeout:1e3,maxBids:1,adapter:"prebidServer",allowUnknownBidderCodes:!1,adapterOptions:{},syncUrlModifier:{},ortbNative:{eventtrackers:[{event:1,methods:[1,2]}]},maxTimeout:1500};function M(e){if(!e)return;const t=Array.isArray(e)?e:[e],n=[];return t.every(((e,t,i)=>{!function(e){["endpoint","syncEndpoint"].forEach((t=>{if((0,r.O8)(e[t])){let n=e[t];e[t]={p1Consent:n,noP1Consent:n}}!(0,r.Qd)(e[t])||e[t].p1Consent&&e[t].noP1Consent||["p1Consent","noP1Consent"].forEach((n=>{e[t][n]||(0,r.JE)(`s2sConfig.${t}.${n} not defined.  PBS request will be skipped in some P1 scenarios.`)}))}))}(e);const s=function(e){if(e.defaultVendor){let t=e.defaultVendor,n=Object.keys(e);if(!b[t])return(0,r.vV)("Incorrect or unavailable prebid server default vendor option: "+t),!1;Object.keys(b[t]).forEach((i=>{W[i]!==e[i]&&(0,p.mK)(n,i)||(e[i]=b[t][i])}))}return e.enabled="boolean"==typeof e.enabled&&e.enabled}(e);if(!1!==s){const s=function(e){const t=Object.keys(e);if(["accountId","endpoint"].filter((e=>!(0,p.mK)(t,e)&&((0,r.vV)(e+" missing in server to server config"),!0))).length>0)return!1}(e);if(!1!==s)return Array.isArray(e.bidders)&&(i[t].bidders=e.bidders.filter((e=>-1===n.indexOf(e)&&(n.push(e),!0)))),!0}return(0,r.JE)("prebidServer: s2s config is disabled"),!1}))?N=t:void 0}function G(e,t,n,i,s){if(N.length===V)return;V++;let d={};const o=J("userSync.filterSettings");if(o){const{all:e,iframe:t,image:n}=o,i=t||e,s=n||e;i&&(d=Object.assign({iframe:i},d)),s&&(d=Object.assign({image:s},d))}const a={uuid:(0,r.lk)(),bidders:e,account:s.accountId,filterSettings:d};let c=s.userSyncLimit;(0,r.Et)(c)&&c>0&&(a.limit=c),t&&(a.gdpr=t.gdprApplies?1:0,!1!==t.gdprApplies&&(a.gdpr_consent=t.consentString)),n&&(a.us_privacy=n),i&&(a.gpp_sid=i.applicableSections.join(),a.gpp=i.gppString),"boolean"==typeof s.coopSync&&(a.coopSync=s.coopSync);const u=JSON.stringify(a);(0,l.RD)(K(s.syncEndpoint,t),(e=>{try{L((e=JSON.parse(e)).bidder_status,s)}catch(e){(0,r.vV)(e)}}),u,{contentType:"text/plain",withCredentials:!0})}function L(e,t){if(0===e.length)return;const n=e.shift();n.no_cookie?function(e,t,n,i,s){s.syncUrlModifier&&"function"==typeof s.syncUrlModifier[n]&&(t=s.syncUrlModifier[n](e,t,n));!function(e,t,n,i,s){t?"image"===e||"redirect"===e?((0,r.OG)(`Invoking image pixel user sync for bidder: "${n}"`),(0,r.z$)(t,i,s)):"iframe"===e?((0,r.OG)(`Invoking iframe user sync for bidder: "${n}"`),(0,r.SG)(t,i,s)):((0,r.vV)(`User sync type "${e}" not supported for bidder: "${n}"`),i()):((0,r.vV)(`No sync url for bidder "${n}": ${t}`),i())}(e,t,n,i,s.syncTimeout)}(n.usersync.type,n.usersync.url,n.bidder,L.bind(null,e,t),t):L(e,t)}a.$W.setDefaults({s2sConfig:W}),J("s2sConfig",(e=>{let{s2sConfig:t}=e;return M(t)}));let F={};function Y(e){const t=function(e,t){if([e,t].every(r.O8))return F[`${e}${t}`]}(e.auctionId,e.adId);var n,i;(0,r.O8)(t)&&((0,r.OG)(`Invoking image pixel for wurl on BID_WIN: "${t}"`),(0,r.z$)(t),n=e.auctionId,i=e.adId,[n,i].every(r.O8)&&(F[`${n}${i}`]=void 0))}function K(e,t){const n=(0,g.C)(t),i=n?e.p1Consent:e.noP1Consent;return i||(0,r.JE)("Missing matching consent URL when gdpr="+n),i}function z(e){let t,n,i;return Array.isArray(e)&&e.length>0&&(t=e[0].gdprConsent,n=e[0].uspConsent,i=e[0].gppConsent),{gdprConsent:t,uspConsent:n,gppConsent:i}}const H=(0,f.A_)("sync",(function(e,t,n,i){let{onResponse:s,onError:d,onBid:c,onFledge:u}=i,{gdprConsent:b}=z(t);const l=(0,r.Go)(e.ad_units),f=l.map((e=>e.bids.map((e=>e.bidder)).filter(r.hj))).reduce(r.Bq,[]).filter(r.hj),g=e.metrics.measureTime("buildRequests",(()=>function(e,t,n,i){const s=(0,r.vE)(),d=new Set,c=[],u=(0,o.K5)(e.s2sConfig),p=(()=>{const e=(0,O.$p)(u),t={};return n=>null==n?e:(t.hasOwnProperty(n)||(t[n]=(0,O.$p)((0,q.s)(E.tW,n))),t[n])})();(n=n.map((e=>p().bidRequest(e)))).forEach((e=>{const i=new Map;n.bids=e.bids.map((e=>p(e.bidder).bidRequest(e))),e.bids.forEach((n=>{null!=n.mediaTypes&&(0,r.JE)(`Prebid Server adapter does not (yet) support bidder-specific mediaTypes for the same adUnit. Size mapping configuration will be ignored for adUnit: ${e.code}, bidder: ${n.bidder}`),i.set(n.bidder,(0,r.D4)(n.bid_id,t))}));let s=e.code,o=1;for(;d.has(s);)o++,s=`${e.code}-${o}`;d.add(s),c.push({...e,adUnitCode:e.code,pbsData:{impId:s,actualBidRequests:i,adUnit:e}})}));const b={...Object.fromEntries(Object.entries(t[0]).filter((e=>{let[t]=e;return!D.has(t)}))),paapi:{enabled:t.some((e=>e.paapi?.enabled))}};return k.toORTB({bidderRequest:b,bidRequests:c,context:{currency:a.$W.getConfig("currency.adServerCurrency")||"USD",ttl:e.s2sConfig.defaultTtl||60,requestTimestamp:s,s2sBidRequest:{...e,ortb2Fragments:P(e.ortb2Fragments,i)},requestedBidders:i,actualBidderRequests:t,nativeRequest:e.s2sConfig.ortbNative,getRedactor:p,transmitTids:(0,I.io)(x.VJ,u)}})}(e,t,l,f))),m=g&&JSON.stringify(g);(0,r.fH)("BidRequest: "+m);const h=K(e.s2sConfig.endpoint,b),C=e?.s2sConfig?.customHeaders??{};if(g&&m&&h){const t=e.metrics.startTiming("net");n(h,{success:function(n){let i;t();try{i=JSON.parse(n);const{bids:t,paapi:s}=e.metrics.measureTime("interpretResponse",(()=>function(e,t){return k.fromORTB({response:e,request:t})}(i,g)));t.forEach(c),s&&s.forEach(u)}catch(e){(0,r.vV)(e)}!i||i.status&&(0,p.mK)(i.status,"Error")?((0,r.vV)("error parsing response: ",i?i.status:"not valid JSON"),s(!1,f)):s(!0,f,i)},error:function(){t(),d.apply(this,arguments)}},m,{contentType:"text/plain",withCredentials:!0,browsingTopics:(0,I.io)(x.DL,(0,o.K5)(e.s2sConfig)),customHeaders:C})}else(0,r.vV)("PBS request not made.  Check endpoints.")}),"processPBSRequest");function Q(e,t){return e?.extPrebid?.returnallbidstatus?t?.ext?.seatnonbid:void 0}function X(e){return e?.ext?.prebid?.analytics?.tags}o.Ay.registerBidAdapter(new function(){const e=new s.A("prebidServer");return e.callBids=function(e,t,n,i,s){const p=e.metrics=(0,U.BO)(t?.[0]?.metrics).newMetrics().renameWith((t=>[`adapter.s2s.${t}`,`adapters.s2s.${e.s2sConfig.defaultVendor}.${t}`]));i=p.startTiming("total").stopBefore(i),t.forEach((e=>(0,U.BO)(e.metrics).join(p,{continuePropagation:!1})));let{gdprConsent:b,uspConsent:l,gppConsent:f}=z(t);if(Array.isArray(N)){if(e.s2sConfig&&e.s2sConfig.syncEndpoint&&K(e.s2sConfig.syncEndpoint,b)){const t=(e.s2sConfig.extPrebid&&e.s2sConfig.extPrebid.aliases)??{};G(e.s2sConfig.bidders.map((e=>o.Ay.aliasRegistry[e]||t[e]||e)).filter(((e,t,n)=>n.indexOf(e)===t)),b,l,f,e.s2sConfig)}H(e,t,s,{onResponse:function(n,s,r){n&&t.forEach((e=>u.Ic(d.qY.BIDDER_DONE,e)));const{seatNonBidData:c,atagData:g}=function(e,t){return{atagData:X(t),seatNonBidData:Q(e,t)}}(e.s2sConfig,r);if(c&&u.Ic(d.qY.SEAT_NON_BID,{seatnonbid:r.ext.seatnonbid,auctionId:t[0].auctionId,requestedBidders:s,response:r,adapterMetrics:p}),c||g){const e={seatnonbid:c,atag:g,auctionId:t[0].auctionId,requestedBidders:s,response:r,adapterMetrics:p};u.Ic(d.qY.PBS_ANALYTICS,e)}i(!1),function(e,t,n,i){e.forEach((e=>{let s=o.Ay.getBidAdapter(e);s&&s.registerSyncs&&a.$W.runWithBidder(e,s.registerSyncs.bind(s,[],t,n,i))}))}(s,b,l,f)},onError(n,s){const{p1Consent:o="",noP1Consent:a=""}=e?.s2sConfig?.endpoint||{};o===a?(0,r.vV)(`Prebid server call failed: '${n}'. Endpoint: "${o}"}`,s):(0,r.vV)(`Prebid server call failed: '${n}'. Endpoints: p1Consent "${o}", noP1Consent "${a}"}`,s),t.forEach((e=>u.Ic(d.qY.BIDDER_ERROR,{error:s,bidderRequest:e}))),i(s.timedOut)},onBid:function(t){let{adUnit:i,bid:s}=t;const o=s.metrics=e.metrics.fork().renameWith();var a,u,p;o.checkpoint("addBidResponse"),null!=s.requestId&&null!=s.requestBidder||e.s2sConfig.allowUnknownBidderCodes?o.measureTime("addBidResponse.validate",(()=>(0,c.fn)(i,s)))?(n(i,s),s.pbsWurl&&(a=s.auctionId,u=s.adId,p=s.pbsWurl,[a,u].every(r.O8)&&(F[`${a}${u}`]=p))):n.reject(i,s,d.Tf.INVALID):((0,r.JE)(`PBS adapter received bid from unknown bidder (${s.bidder}), but 's2sConfig.allowUnknownBidderCodes' is not set. Ignoring bid.`),n.reject(i,s,d.Tf.BIDDER_DISALLOWED))},onFledge:e=>{a.$W.runWithBidder(e.bidder,(()=>{(0,c.JN)({auctionId:t[0].auctionId,...e},{config:e.config})}))}})}},u.on(d.qY.BID_WON,Y),Object.assign(this,{callBids:e.callBids,setBidderCode:e.setBidderCode,type:_})},"prebidServer"),(0,i.E)("prebidServerBidAdapter"),(0,i.E)("prebidServerBidAdapter")}},e=>{e.O(0,[802,498,618,225,85],(()=>{return t=7616,e(e.s=t);var t}));e.O()}]);