(self.pbjsChunk=self.pbjsChunk||[]).push([[129],{7496:(t,e,r)=>{var n=r(8676),o=r(9328),s=r(2707),i=r(1218),a=r(433),c=r(3172),d=r(7260),u=r(9024);const p="permutive",m=(0,i.h0)("[PermutiveRTD]"),f="permutive-prebid-rtd",g="p_standard",l="permutive",b="p_standard_aud",h=(0,s.vM)({moduleType:u.zu,moduleName:p});function v(t){return(0,i.Qd)(t)?{params:t}:{}}let w={};function x(t){const e=function(){try{return v(window.permutive.addons.prebid.getPermutiveRtdConfig())}catch(t){return null}}()||w;return(0,i.D9)({waitForIt:!1,params:{maxSegs:500,acBidders:[],overwrites:{}}},e,t)}function _(t,e,r){const n=(0,a.A)(e,"params.acBidders"),o=(0,a.A)(e,"params.maxSegs"),s=(0,a.A)(e,"params.transformations")||[],d=r?.ssp?.ssps??[],u=r?.ssp?.cohorts??[],p=r?.topics??{};new Set([...n,...d]).forEach((function(e){const f={ortb2:t[e]||{}};let h=[];n.indexOf(e)>-1&&(h=r.ac);d.indexOf(e)>-1&&(h=[...new Set([...h,...u])].slice(0,o));const v=function(t,e,r,n,o,s,d){m.logInfo("Current ortb2 config",{bidder:t,config:e});const u=(0,a.A)(d,t)||[],p="permutive.com",f={name:p,segment:r.map((t=>({id:t})))},h=s.filter((t=>{let{id:e}=t;return D.hasOwnProperty(e)})).map((t=>{let{id:e,config:r}=t;return D[e](f,r)})),v={name:l,segment:u.map((t=>({id:t})))},w=(0,i.D9)({},e),x=(0,a.A)(w,"ortb2.user.data")||[];let _=[];for(const[t,e]of Object.entries(o))_.push({name:p,ext:{segtax:Number(t)},segment:e.map((t=>({id:t.toString()})))});const y=x.filter((t=>t.name!==f.name&&t.name!==v.name)).concat(f,h,v).concat(_);m.logInfo("Updating ortb2.user.data",{bidder:t,user_data:y}),(0,c.J)(w,"ortb2.user.data",y);const A=(0,a.A)(w,"ortb2.user.keywords"),S={[g]:r,[b]:n,[l]:u},I=Object.entries(S).flatMap((t=>{let[e,r]=t;return r.map((t=>`${e}=${t}`))})),$=[A,...I].filter(Boolean).join(",");m.logInfo("Updating ortb2.user.keywords",{bidder:t,keywords:$}),(0,c.J)(w,"ortb2.user.keywords",$),r.length>0&&((0,c.J)(w,`ortb2.user.ext.data.${g}`,r),m.logInfo(`Extending ortb2.user.ext.data with "${g}"`,r));u.length>0&&((0,c.J)(w,`ortb2.user.ext.data.${l}`,u.map(String)),m.logInfo(`Extending ortb2.user.ext.data with "${l}"`,u));r.length>0&&((0,c.J)(w,`ortb2.site.ext.permutive.${g}`,r),m.logInfo(`Extending ortb2.site.ext.permutive with "${g}"`,r));return m.logInfo("Updated ortb2 config",{bidder:t,config:w}),w}(e,f,h,u,p,s,r);t[e]=v.ortb2}))}function y(t,e,r){const o=t&&t.adUnits||(0,n.m)().adUnits,s={deepSetValue:c.J,deepAccess:a.A,isFn:i.fp,mergeDeep:i.D9},u={appnexusAst:"appnexus"};o&&o.forEach((t=>{t.bids.forEach((t=>{let{bidder:n}=t;void 0!==u[n]&&(n=u[n]);const o=function(t,e){const r=(0,a.A)(t,"params.acBidders")||[];return(0,d.mK)(r,e)}(e,n),c=function(t,e){const r=(0,a.A)(t,`params.overwrites.${e}`);return r&&(0,i.fp)(r)?r:null}(e,n);if(c){const e=t=>t;c(t,r,o,s,e)}}))}))}function A(t){try{t()}catch(t){(0,i.vV)(t)}}function S(t,e){try{return JSON.parse(h.getDataFromLocalStorage(t))||e}catch(t){return e}}const I="_unknown_",D={iab:(t,e)=>({name:t.name,ext:{segtax:e.segtax},segment:(t.segment||[]).map((t=>{return{id:(r=t.id,n=e.iabIds,n[r]||I)};var r,n})).filter((t=>t.id!==I))})};function $(t,e){const r=function(t){const e=S("_psegs",[]).map(Number).filter((t=>t>=1e6)).map(String),r=S("_ppam",[]),n={ac:[...S("_pcrprs",[]),...r,...e],ix:S("_pindexs",[]),rubicon:S("_prubicons",[]),appnexus:S("_papns",[]),gam:S("_pdfps",[]),ssp:S("_pssps",{cohorts:[],ssps:[]}),topics:S("_ppsts",{})};for(const e in n)if("ssp"===e)n[e].cohorts&&Array.isArray(n[e].cohorts)&&(n[e].cohorts=n[e].cohorts.slice(0,t));else if("topics"===e)for(const r in n[e])n[e][r]=n[e][r].slice(0,t);else n[e]=n[e].slice(0,t);return n}((0,a.A)(e,"params.maxSegs"));A((function(){y(t,e,r)})),A((function(){_(t.ortb2Fragments?.bidder,e,r)}))}let E=!1;const O={name:p,getBidRequestData:function(t,e,r){const n=()=>{m.logInfo("Request data updated"),e()},o=x(r);$(t,o),A((function(){if(E||!o.waitForIt||void 0===window.permutive||"function"!=typeof window.permutive.ready)return n();window.permutive.ready((function(){m.logInfo("SDK is realtime, updating cohorts"),E=!0,$(t,x(r)),n()}),"realtime"),m.logInfo("Registered cohort update when SDK is realtime")}))},init:function(t,e){return function(){const t=(0,i.$l)(h.getDataFromLocalStorage(f));w=v(t)}(),!0}};(0,o.bz)("realTimeData",O),(0,n.E)("permutiveRtdProvider"),(0,n.E)("permutiveRtdProvider")}},t=>{t.O(0,[802,85],(()=>{return e=7496,t(t.s=e);var e}));t.O()}]);